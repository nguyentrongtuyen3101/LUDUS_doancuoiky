<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reset Password - Ludus</title>
  <style>
    * { box-sizing: border-box; margin:0; padding:0; font-family: "Poppins", Arial, sans-serif; }
    body { display:flex; flex-direction:column; min-height:100vh; background-color:#f9f9f9; color:#111; }
    a { text-decoration:none; color:inherit; }
    header { border-bottom:1px solid #ddd; padding:25px 5%; display:flex; justify-content:space-between; align-items:center; background:linear-gradient(180deg,#fff,#f5f5f5); box-shadow:0 2px 8px rgba(0,0,0,0.1); position:sticky; top:0; z-index:1000; }
    header h1 { font-size:32px; font-weight:800; letter-spacing:1px; color:#ff4d00; display:flex; align-items:center; }
    header h1::before { content:"üéÆ"; margin-right:10px; font-size:28px; }
    nav a { margin-left:30px; font-size:16px; color:#111; font-weight:600; transition: color 0.3s ease, transform 0.3s ease; }
    nav a:hover { color:#ff4d00; transform:translateY(-2px); }
    main { flex:1; padding:80px 20px; display:flex; justify-content:center; align-items:center; }
    .container { width:100%; max-width:600px; background:#fff; border:1px solid #e0e0e0; border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,0.08); padding:50px 40px; }
    .breadcrumb { color:#666; font-size:15px; margin-bottom:30px; text-align:left; }
    h2 { text-align:center; font-size:28px; font-weight:700; margin-bottom:40px; letter-spacing:0.8px; color:#222; }
    label { display:block; font-weight:600; font-size:16px; color:#333; margin-bottom:10px; }
    input[type="password"] { width:100%; padding:14px 16px; border:1px solid #ccc; border-radius:6px; font-size:16px; margin-bottom:25px; transition:border-color 0.3s ease, box-shadow 0.3s ease; }
    input[type="password"]:focus { border-color:#ff4d00; box-shadow:0 0 8px rgba(255,77,0,0.2); outline:none; }
    button { display:block; width:100%; background:#ff4d00; border:none; color:white; padding:14px; font-size:16px; border-radius:6px; font-weight:600; letter-spacing:0.5px; cursor:pointer; transition: all 0.3s ease; }
    button:hover { background:#fff; border:2px solid #ff4d00; color:#ff4d00; }
    .back-login { display:block; margin-top:25px; font-size:15px; text-align:center; color:#111; font-weight:500; transition: color 0.3s ease; }
    .back-login:hover { color:#ff4d00; }
    footer { background:#111; color:#ddd; padding:50px 5%; display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:30px; }
    footer h4 { color:#fff; font-size:16px; margin-bottom:10px; border-bottom:2px solid #ff4d00; display:inline-block; padding-bottom:4px; }
    footer p, footer a { color:#aaa; font-size:14px; line-height:1.6; }
    footer a:hover { color:#ff4d00; }
    footer input[type="email"] { width:100%; padding:10px; border:none; border-radius:4px; margin-top:8px; }
    footer button { margin-top:10px; background:#ff4d00; color:white; border:none; padding:10px 18px; border-radius:4px; cursor:pointer; font-weight:600; }
    footer button:hover { background:white; color:#ff4d00; }
    @media (max-width:768px) {
      header { flex-direction:column; align-items:flex-start; padding:20px 5%; }
      nav { margin-top:15px; }
      nav a { margin-left:20px; font-size:15px; }
      main { padding:50px 10px; }
      .container { padding:40px 25px; }
      h2 { font-size:24px; }
      footer { text-align:center; grid-template-columns:1fr; }
      footer div { margin-bottom:20px; }
    }
  </style>
</head>
<body>

<header>
  <h1>Ludus</h1>
  <nav>
    <a href="#">Home</a>
    <a href="#">Shop</a>
    <a href="#">Blog</a>
    <a href="#">Contact</a>
  </nav>
</header>

<main>
  <div>
    <div class="breadcrumb">Home / Reset</div>
    <div class="container">
      <h2>RESET PASSWORD</h2>
      <label for="password">NEW PASSWORD *</label>
      <input type="password" id="password" placeholder="Enter new password" required>
      <button id="submitBtn">SUBMIT</button>
      <a href="/login" class="back-login">Back to Login</a>
    </div>
  </div>
</main>

<footer>
  <div>
    <h4>Contact Us</h4>
    <p>4247 Ashford Drive Virginia VA-20006 USA</p>
    <p>üìû (+01) 900 901 904</p>
    <p>‚úâÔ∏è contact@domain.com</p>
  </div>
  <div>
    <h4>Information</h4>
    <p><a href="#">Cart</a></p>
    <p><a href="#">Account</a></p>
    <p><a href="#">Manufacturer</a></p>
  </div>
  <div>
    <h4>Our Company</h4>
    <p><a href="#">About Us</a></p>
    <p><a href="#">Contact Us</a></p>
    <p><a href="#">Sitemap</a></p>
  </div>
  <div>
    <h4>Join our Newsletter</h4>
    <input type="email" placeholder="Enter your email" />
    <button>SUBSCRIBE</button>
  </div>
</footer>

<script>
  // L·∫•y token t·ª´ URL
  const params = new URLSearchParams(window.location.search);
  const token = params.get('token');

  const submitBtn = document.getElementById('submitBtn');
  const passwordInput = document.getElementById('password');

  // URL redirect sau khi reset th√†nh c√¥ng
  const SUCCESS_REDIRECT_URL = "https://your-frontend-domain.com/login"; 

  // H√†m validate theo DTO
  function validatePassword(password) {
    const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
    return passwordRegex.test(password);
  }

  submitBtn.addEventListener('click', async () => {
    const password = passwordInput.value.trim();

    if (!password) {
      alert("Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u m·ªõi!");
      return;
    }

    if (!validatePassword(password)) {
      alert("Password must contain at least 8 characters, including uppercase, lowercase, number, and special character");
      return;
    }

    if (!token) {
      alert("Token kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ h·∫øt h·∫°n!");
      return;
    }

    try {
      const res = await fetch(`http://localhost:3000/auth/reset-password?token=${token}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password })
      });

      const data = await res.json();

      if (res.ok) {
        // Redirect sang URL c·ªë ƒë·ªãnh
        window.location.href = SUCCESS_REDIRECT_URL;
      } else {
        alert(data.message || "ƒê√£ c√≥ l·ªói x·∫£y ra");
      }
    } catch (err) {
      console.error(err);
      alert("Kh√¥ng th·ªÉ reset password, th·ª≠ l·∫°i sau!");
    }
  });
</script>


</body>
</html>
